<!DOCTYPE html>
<html>
<head>
  <title>zeo vr</title>
  <link href="/css/style.css" rel=stylesheet>
  <link href="/css/octicons.css" rel=stylesheet>
  <link href="/css/github-markdown.css" rel=stylesheet>
</head>
<body>
  <header class=header>
    <div class=header-left>
      <a href="https://zeovr.io" class=header-logo-anchor><img width=32 height=51 src="/img/logo.png" class=header-icon>zeo vr</a>
    </div>
    <div class=demographics>
      <navbar>
        <a href="/" class=green>Try it</a>
        <a href="/docs" class=green>API Docs</a>
        <a href="/modules" class="green selected">Modules</a>
        <a href="/servers" class=green>Servers</a>
      </navbar>
    </div>
    <div class=header-right>
      <a href="https://github.com/modulesio/zeo" class=header-github-anchor>
        <div class=header-github-anchor-notch></div>
        <i class="octicon octicon-mark-github"></i>
      </a>
    </div>
  </header>
  <div class=content>
    <div class="module-body markdown-body" id=module-body></div>
    <footer class=footer>
      <div class="footer-wrap full">
        <div class=footer-left><a href="/" class="link soft">Home</a> | <a href="https://github.com/modulesio/zeo" class="link soft">Github</a> | <a href="mailto:hello@zeovr.io" class="link soft">Contact</a></div>
        <div class=footer-right>&copy; 2017 <a href="mailto:a@zeovr.io">Zeo VR</a></div>
      </div>
    </footer>
  </div>
  <script>
const $ = s => document.querySelectorAll(s);
const $$ = (e, s) => e.querySelectorAll(s);

const moduleBody = $('#module-body')[0];

const _makeModuleElement = module => {
  const {readme} = module;

  const div = document.createElement('div');
  div.innerHTML = `<div class=readme>
    <div class=readme-content>
      <h1 class=readme-header>
        <img class=readme-image />
        <div class=readme-header-wrap>
          <div href="/modules/${module.name}" class=name>${module.displayName}</div>
          <div class=version>${module.version}</div>
        </div>
      </h1>
      ${readme ?
        readme
      :
        `<div class=readme-placeholder>No readme</div>`
      }
    </div>
    <div class=readme-sidebar>
      <h4 class=label>Install this module</h4>
      <pre class=code>&ltmodule src="${module.name}"&gt;&lt;/module&gt;</pre>
      <div class=hint><b>Hint:
          <i>To install this module...</i></b>
        <ul>
          <li>paste in the server window (<i>Ctrl-V</i>), or</li>
          <li>add it to the <code>&lt;modules&gt;</code> tag, or</li>
          <li>search for it in the VR UI</li>
        </ul>
      </div>
    </div>
  </div>`;
  const moduleElement = div.childNodes[0];

  const codeElement = $$(moduleElement, '.code')[0];
  codeElement.onclick = () => {
    const selection = window.getSelection();
    const range = document.createRange();
    range.selectNodeContents(codeElement);
    selection.removeAllRanges();
    selection.addRange(range);
  };

  _getFakeImgUrl()
    .then(url => {
      $$(moduleElement, 'img')[0].src = url;
    });

  return moduleElement;
};
const _getFakeImgUrl = () => fetch('https://www.reddit.com/r/wallpapers/.json')
  .then(res => res.json()
    .then(j => {
      const urls = j.data.children.map(o => o.data.url);
      const validUrls = urls
        .filter(url => /\.(?:png|jpg)$/.test(url))
        .map(url => url.replace(/^http:\/\//, 'https://'));
      const url = validUrls[Math.floor(Math.random() * validUrls.length)];
      return url;
    })
  );
const _update = () => {
  const match = window.location.pathname.match(/^\/modules\/(.*)$/);
  const mod = match[1];

  fetch('/archae/rend/mods?q=' + mod)
    .then(res =>
      res.json()
        .then(module => {
          const moduleElement = _makeModuleElement(module);
          moduleBody.appendChild(moduleElement);
        })
    );
};
_update();
  </script>
</body>
</html/>
