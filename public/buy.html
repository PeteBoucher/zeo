<!DOCTYPE html>
<html>
<head>
  <title>Module - Zeo</title>
  <link href="/css/style.css" rel=stylesheet>
  <link href="/css/header.css" rel=stylesheet>
  <link href="/css/github-markdown.css" rel=stylesheet>
</head>
<body>
  <!-- header.html -->
  <script>
window.$ = s => document.querySelectorAll(s);

$('navbar > a').forEach(el => {
  el.classList.remove('selected');
});
  </script>
  <div class=content>
    <div class=buy-body>
      <h1>Confirm payment</h1>
      <div class=row>
        <div id=buy-src-body></div>
        <img src="/img/arrow-right.svg">
        <div id=buy-dst-body></div>
      </div>
      <div class=row>
        <a class="button primary">Confirm</a>
        <a class=button>Cancel</a>
      </div>
    </div>
    <footer class=footer>
      <div class="footer-wrap full">
        <div class=footer-left><a href="/" class="link soft">Home</a> | <a href="https://github.com/modulesio/zeo" class="link soft">Github</a> | <a href="mailto:hello@zeovr.io" class="link soft">Contact</a></div>
        <div class=footer-right>&copy; 2017 <a href="mailto:a@zeovr.io">Zeo VR</a></div>
      </div>
    </footer>
  </div>
  <script src="/js/lib/creaturejs.js"></script>
  <script>
const buySrcBody = $('#buy-src-body')[0];
const buyDstBody = $('#buy-dst-body')[0];

const _commaize = n => String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
const _makeAssetElement = (asset, quantity) => {
  const quantityString = _commaize(quantity);

  const el = document.createElement('div');
  el.classList.add('asset');
  el.style.cssText = 'position: relative; display: flex; width: 300px; height: 100px; background-color: #EEE; padding-left: 30px; text-decoration: none; overflow: hidden; box-sizing: border-box;';
  el.innerHTML = `\
    <div style="display: flex; position: absolute; top: 40px; left: -40px; width: 100px; height: 20px; background-color: #FFC107; font-size: 13px; justify-content: center; align-items: center; box-sizing: border-box; transform: rotate(-90deg);">Asset</div>
    <div style="display: flex; margin-left: -30px; padding-left: 20px; flex-grow: 1; flex-direction: column; box-sizing: border-box;">
      <div style="display: flex; flex-grow: 1;">
        <img class=asset-image width="50" height="50" style="margin: 10px; image-rendering: -moz-crisp-edges; image-rendering: pixelated;" />
        <div style="display: flex; max-width: ${300 - (20) - (50 + (10 * 2)) - (30 + (15 * 2))}px; flex-grow: 1; flex-direction: column; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
          <h1 style="margin: 0; margin-top: 15px; padding: 0; font-size: 16px; font-weight: 600; line-height: 1.4;">${asset}</h1>
          <div style="display: flex; flex-grow: 1; align-items: center;">
            <div style="padding: 0 7px; border: 2px solid; font-size: 16px; font-weight: 400;">&#164; ${quantityString}</div>
          </div>
        </div>
      </div>
    </div>
  `;
  return el;
};
const _update = () => {
  const match = window.location.pathname.match(/(?:\?([\s\S]+))?$/);
  const queryString = match[1] || '';
  const query = parseQueryString(queryString);
  const {srcAsset, srcQuantity: srcQuantityString, dstAsset, dstQuantity: dstQuantityString} = query;
  const srcQuantity = parseInt(srcQuantityString, 10);
  const dstQuantity = parseInt(dstQuantityString, 10);

  const srcBuyElement = _makeAssetElement(srcAsset, srcQuantity);
  buySrcBody.appendChild(srcBuyElement);

  const dstBuyElement = _makeAssetElement(dstAsset, dstQuantity);
  buyDstBody.appendChild(dstBuyElement);

  setTimeout(() => {
    srcBuyElement.querySelectorAll('.asset-image')[0].src = creaturejs.makeStaticCreature('asset:' + srcAsset);
    dstBuyElement.querySelectorAll('.asset-image')[0].src = creaturejs.makeStaticCreature('asset:' + dstAsset);
  });
};
_update();

function parseQueryString(s) {
  const result = {};
  const query = window.location.search.substring(1);
  const vars = query.split('&');
  for (let i = 0; i < vars.length; i++) {
    const pair = vars[i].split('=');
    result[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
  }
  return result;
}
  </script>
</body>
</html/>
